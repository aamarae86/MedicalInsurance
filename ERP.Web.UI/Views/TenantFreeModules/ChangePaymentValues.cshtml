@using ERP.ResourcePack.Accounts
@using ERP.Web.UI.Models.ViewModels.Tenant
@model  TenantModuleVM
@{
    string lang = Request.Cookies["Lang"] == null ? "ar-EG" : Request.Cookies["Lang"].Value.ToString();
}


 
@*<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js" integrity="sha512-qTXRIMyZIFb8iQcfjXWCO8+M5Tbc38Qi5WzdPOYZHIlZpzBHG3L3by84BBBOiRGiEb7KKtAOAs5qYdUiZiQNNQ==" crossorigin="anonymous"></script>*@
<div class="card shadow-rounded">
    <div class="card-body ">
        <h3 class="card-title text-center p-2">@Model.TenantInfo.Name</h3>
        <input type="hidden" name="TenantId" id="TenantId" value="@Model.TenantInfo.Id" />
        <div class="row clearfix shadow-rounded py-1 pt-3">

            <div class="col-sm-4">
                <div class="form-group form-float">
                    <div class="form-line">
                        <input disabled type="text" class="form-control" name="Tel" value="@Model.TenantInfo.Tel" />
                        <label class="form-label">@ReportsAccounts.Tel</label>

                    </div>
                </div>
            </div>


            <div class="col-sm-4">
                <div class="form-group form-float">
                    <div class="form-line">
                        <input disabled type="text" class="form-group" name="Email" value="@Model.TenantInfo.Email" />
                        <label class="form-label">@ReportsAccounts.Email</label>
                    </div>
                </div>
            </div>

            <div class="col-sm-4">
                <div class="form-group form-float">
                    <div class="form-line">
                        <input disabled type="text" class="form-group" name="CreationTime" value="@Model.TenantInfo.CreationTime" />
                        <label class="form-label">@ReportsAccounts.CreationTime</label>
                    </div>
                </div>
            </div>


            <div class="col-sm-4">
                <div class="form-group form-float">
                    <div class="form-line">
                        <input disabled type="text" class="form-group" name="ManagerName" value="@Model.TenantInfo.ManagerName" />
                        <label class="form-label">@ReportsAccounts.ManagerName</label>
                    </div>
                </div>
            </div>     
            
            <div class="col-sm-4">
                <div class="form-group form-float">
                    <div class="form-line">
                        <input disabled type="text" class="form-group" name="RemainingDays" value="@Model.TenantInfo.RemainingDays" />
                        <label class="form-label">@ReportsAccounts.RemainingDays</label>
                    </div>
                </div>
            </div>



         
        </div>

        <div class="row shadow-rounded my-3 py-1 pt-3">

            <div class="col-sm-4">
                <div class="form-group form-float">

                    <div class="form-line">
                        <input type="number" class="form-group" id="AdminValue" name="AdminValue" value="@Model.TenantInfo.AdminValue" />
                        <label class="form-label">@ReportsAccounts.AdminValue</label>
                    </div>

                </div>
            </div>

            <div class="col-sm-4">
                <div class="form-group form-float">

                    <div class="form-line">
                        <input type="number" class="form-group" id="UserValue" name="UserValue" value="@Model.TenantInfo.UserValue" />
                        <label class="form-label">@ReportsAccounts.UserValue</label>
                    </div>

                </div>
            </div>

            <div class="col-sm-4">
                <div class="form-group form-float">

                    <div class="form-line">
                        <input disabled type="text" class="form-group " id="SubEndDate_ro" name="SubEndDate_ro" data-old-SubEndDate="@Model.TenantInfo.AdminSubEndDate" value="@Model.TenantInfo.AdminSubEndDate" />
                        <label class="form-label">@ERP.ResourcePack.Common.Settings.EndDate</label>
                    </div>

                </div>
            </div>

         
 

                <div class="col-sm-4">
                    <div class="form-group form-float">

                        <div class="form-line">
                            <div class="date-days js-days" style="display:none ;direction: ltr;"> </div>
                            <input type="text" class="form-group datepicker " id="SubEndDate" name="SubEndDate" value="@Model.TenantInfo.AdminSubEndDate" />
                            <label class="form-label lbd-date">@ReportsAccounts.RenewalDate</label>
                        </div>

                    </div>
                </div>

                <div class="col-sm-4 d-none">
                    <div class="form-group form-float">
                        <div class="form-line">
                            <input type="number" class="form-group" id="AllowedDayes" name="AllowedDayes" value=" " />
                            <label class="form-label">@ReportsAccounts.AddDays</label>
                        </div>
                    </div>
                </div>

        


        </div>
         
  
        </div>
    </div>
        <div class="row clearfix">
            <div class="form-group text-center form-float">
                <button id="ChgPayDetailsSaveBtn" type="button" class="btn btn-primary btn-lg m-l-15 waves-effect">@ERP.ResourcePack.Common.Settings.BtnSave</button>
                <div id="submitLoader" style="display:none">
                    <div class="lds-roller"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div>
                </div>
            </div>
        </div>
   
 
<script src="~/Scripts/jquery.validate.min.js"></script>
<script src="~/Scripts/jquery.validate.unobtrusive.min.js"></script>
<script src="~/AssetsPack/assets/js/pages/forms/basic-form-elements.js"></script>

<script>
    $('#ChgPayDetailsSaveBtn').click(function () {

        if (Validation()) {
            $.ajax({
                url: `${baseUrl}/Tenant/ChaneTenantPaymentOptions`,
                cache: false,
                type: "POST",
                headers: {
                    'Authorization': `Bearer ${$_token}`,
                    'Content-Type': 'application/json',
                },
                data: JSON.stringify({
                    TenantId: $('#TenantId').val(),
                    AdminSubEndDate: $('#SubEndDate').val(),
                    AllowedDayes: $('#AllowedDayes').val(),

                    AdminValue: $('#AdminValue').val(),
                    UserValue: $('#UserValue').val(),

                })
            })
                .done(function (data) {
                    if (data.result === true) {
                        toastr.success('@ERP.ResourcePack.Accounts.ReportsAccounts.Sved')

                        setTimeout(function () {
                            location.reload()
                         }, 1000);
                    }
                })
                .fail(function () {
                    toastr.error('@ERP.ResourcePack.Accounts.ReportsAccounts.Faild')
                    setTimeout(function () {
                        location.reload()
                    }, 1000);
                })
        }
    });

    $('#main-modal').on('hidden.bs.modal', function () {
        setTimeout(function () {
            location.reload()
        }, 100);
    })

    function Validation() {
       /* $('#AdminSubEndDate').removeClass('error');*/
        $('#AdminValue').removeClass('error');
        $('#UserValue').removeClass('error');

        //if (!$('#AdminSubEndDate').val()) {
        //    $('#AdminSubEndDate').addClass('error');
        //}

        $('#SubEndDate').removeClass('error');

        if (!$('#SubEndDate').val()) {
            $('#SubEndDate').addClass('error');
            return false;
        }

        if (!$('#AdminValue').val()) {
            $('#AdminValue').addClass('error');
        }
        if (!$('#UserValue').val()) {
            $('#UserValue').addClass('error');
        }

        if (!$('#AdminValue').val() ||!$('#UserValue').val() ) {
            return false;
        }
        return true;
    }

    $('#AdminSubEndDate').on('change', function (e) {
        $('#AllowedDayes').val('0').prop("disabled", true);
    });

    $('#AllowedDayes').on('input', function (e) {
        $('#AdminSubEndDate').prop("disabled", true);
    });




    $("#AdminSubEndDate").on('change', function () {
        //debugger;
        var selectedDate = $(this).val();
        let date = $('#SubEndDate_ro').val();  
        var today = moment(moment(), 'DD/MM/YYYY');     
        let olddate = moment(date, 'DD/MM/YYYY');   
        let newdate = moment(selectedDate, 'DD/MM/YYYY');
        $('.js-days').hide();
       
        if (newdate.isBefore(olddate) || newdate.isBefore(today)) {
            $(this).val($('#SubEndDate_ro').val());
            toastr.warning('@ERP.ResourcePack.Common.Settings.selectgraterdate')
        } else {

            var days = newdate.diff(olddate, 'days')
            if (days) {
                $('.js-days').text(`+${days}`).show();
            } else {
                
                days = newdate.diff(today, 'days')
                if (days > 0) {
                    $('.js-days').text(`+${days}`).show();
                } 

            }
            
        }
    });
 

  


</script>