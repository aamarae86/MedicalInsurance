@using ERP.Web.UI.Models.ViewModels.CharityBoxes
@model TmCharityBoxReceiveVM
@{
    string formTrigger = ViewBag.trigger;
    string lang = Request.Cookies["Lang"] == null ? "ar-EG" : Request.Cookies["Lang"].Value.ToString();
    string lkpKeyDdl = "CharityBoxTypeName";
}

<div class="card">
    <div class="body">
        @using (Ajax.BeginForm(nameof(ERP.Web.UI.Controllers.CharityBoxes.TmCharityBoxReceiveController.CreateOrUpdateTmCharityBoxReceive), "TmCharityBoxReceive",
            new AjaxOptions { HttpMethod = "POST", OnBegin = "OnBegin", OnSuccess = "OnSuccess", OnComplete = "OnComplete", OnFailure = "OnFailure" }, new { @id = "mainForm" }))
        {
            @Html.HiddenFor(z => z.Id)
            <div class="row clearfix">
                <div class="col-sm-4">
                    <div class="form-group form-float">
                        <div class="form-line">
                            @Html.TextBoxFor(z => z.ReceiveNumber, new { @class = "form-control", @disabled = true })
                            @Html.LabelFor(z => z.ReceiveNumber, new { @class = "form-label" })
                        </div>
                    </div>
                </div>
                <div class="col-sm-4">
                    <div class="form-group form-float">
                        <div class="form-line">
                            @Html.TextBoxFor(z => z.ReceiveDate, new { @class = "form-control datepicker" })
                            @Html.LabelFor(z => z.ReceiveDate, new { @class = "form-label" })
                        </div>
                        @Html.ValidationMessageFor(z => z.ReceiveDate)
                    </div>
                </div>
                <div class="col-sm-4">
                    <div class="form-group form-float">
                        <div class="form-line">
                            @Html.TextBoxFor(z => z.StatusLkpId, new { @class = "form-control", @disabled = true, @Value = (lang == "ar-EG" ? "جديد" : "New") })
                            @Html.LabelFor(z => z.StatusLkpId, new { @class = "form-label" })
                        </div>
                    </div>
                </div>
            </div>
            <div class="row clearfix">
                <div class="col-sm-4">
                    <div class="form-group form-float">
                        <div class="form-line">
                            @Html.TextBoxFor(z => z.SupplierName, new { @class = "form-control" })
                            @Html.LabelFor(z => z.SupplierName, new { @class = "form-label" })
                        </div>
                    </div>
                </div>
                <div class="col-sm-4">
                    <div class="form-group form-float">
                        @Html.LabelFor(z => z.CharityTypeId, new { @class = "form-label" })
                        <div class="form-group form-float">
                            <div class="form-line">
                                @if (Model != null && Model.CharityBoxesType != null)
                                {
                                    var list = new List<TmCharityBoxesTypeVM> { new TmCharityBoxesTypeVM { Id = Model.CharityTypeId, CharityBoxTypeName = Model.CharityBoxesType.CharityBoxTypeName } };

                                    var selectList = new SelectList(list, "Id", lkpKeyDdl, Model.CharityTypeId);

                                    @Html.DropDownListFor(z => z.CharityTypeId, selectList, new { @class = "form-control" })
                                }
                                else
                                {
                                    @Html.DropDownListFor(z => z.CharityTypeId, Enumerable.Empty<SelectListItem>(), new { @class = "form-control" })
                                }

                                @Html.ValidationMessageFor(z => z.CharityTypeId)
                            </div>
                        </div>
                        @Html.ValidationMessageFor(z => z.CharityTypeId)
                    </div>
                </div>
                <div class="col-sm-4">
                    <div class="form-group form-float">
                        <div class="form-line">
                            @Html.TextBox("Code", null, new { @class = "form-control", @disabled = true, @Value = Model?.CharityBoxesType.TypeCode ?? "" })
                            @Html.LabelFor(z => z.CharityBoxesType.TypeCode, new { @class = "form-label" })
                        </div>
                    </div>
                </div>
            </div>
            <div class="row clearfix">
                <div class="col-sm-4">
                    <div class="form-group form-float">
                        <div class="form-line">
                            @Html.TextBoxFor(z => z.NoOfCharityBox, new { @class = "form-control", @type = "Number" })
                            @Html.LabelFor(z => z.NoOfCharityBox, new { @class = "form-label" })
                        </div>
                    </div>
                </div>
                <div class="col-sm-4">
                    <div class="form-group form-float">
                        <div class="form-line">
                            @Html.TextBoxFor(z => z.AmountCharityBox, new { @class = "form-control", @type = "Number" })
                            @Html.LabelFor(z => z.AmountCharityBox, new { @class = "form-label" })
                        </div>
                        @Html.ValidationMessageFor(z => z.AmountCharityBox)
                    </div>
                </div>
                <div class="col-sm-4">
                    <div class="form-group form-float">
                        <div class="form-line">
                            @Html.TextBox("Total", "0", new { @class = "form-control", @disabled = true, @value = "New" })
                            @Html.Label(lang == "ar-EG" ? "الإجمالي" : "Total", new { @class = "form-label" })
                        </div>
                    </div>
                </div>
            </div>
            <div class="row clearfix">
                <div class="form-group text-center form-float">
                    <button type="submit" class="btn btn-info btn-lg m-l-15 waves-effect">@(Model == null ? ERP.ResourcePack.Common.Settings.BtnSave : ERP.ResourcePack.Common.Settings.BtnUpdate)</button>
                    <div id="submitLoader" style="display:none">
                        <div class="lds-roller"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div>
                    </div>
                </div>
            </div>
        }

        <div class="row clearfix">
            <div class="col-md-12 text-center" id="btnPostOrRefuseCommitteeContainer">
                @if (formTrigger == ERP.Front.Helpers.Enums.Common.FormTriggers.Show.ToString() && Model.StatusLkpId == Convert.ToInt64(ERP.Front.Helpers.Enums.Common.TmCharityBoxReceive.New))
                {
                    <a href="javascript:void(0)" onclick="return PostAjax(@Model.Id)" class="btn btn-success">@ERP.ResourcePack.CharityBoxes.TmCharityBoxReceive.Post</a>
                }
            </div>
        </div>

    </div>
</div>
<script src="~/Scripts/jquery.validate.min.js"></script>
<script src="~/Scripts/jquery.validate.unobtrusive.min.js"></script>
<script src="~/AssetsPack/assets/js/pages/forms/basic-form-elements.js"></script>
<script>

    $(function () {
        calculateTotal();
    });

    function calculateTotal() {
        noOfBoxes = parseFloat($('#main-modal #NoOfCharityBox').val());
        amountInBox = parseFloat($('#main-modal #AmountCharityBox').val());
        totalOfBoxes = noOfBoxes * amountInBox;
        if (isNaN(totalOfBoxes)) {
            totalOfBoxes = 0;
        }
        $('#main-modal #Total').val(totalOfBoxes);
    }

    $('#@nameof(TmCharityBoxReceiveVM.StatusLkpId)').parent('.form-line').addClass('focused');
    $('#@nameof(TmCharityBoxReceiveVM.ReceiveNumber)').parent('.form-line').addClass('focused');
    $('#Code').parent('.form-line').addClass('focused');
    $('#Total').parent('.form-line').addClass('focused');

    $('#main-modal #CharityTypeId').select2(ReturnSelect2ObjectDefault(`${baseUrl}/TmCharityBoxesType/GetSelect2`));

    $('#main-modal #CharityTypeId').on("select2:select", function (e) {
        $('#main-modal #Code').val(e.params.data.altText);
    });

    $('#main-modal #NoOfCharityBox').on("blur", function () {
        calculateTotal();
    });

    $('#main-modal #AmountCharityBox').on("blur", function () {
        calculateTotal();
    });
</script>