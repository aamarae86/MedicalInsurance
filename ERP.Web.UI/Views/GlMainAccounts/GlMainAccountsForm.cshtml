@using ERP.Web.UI.Models.ViewModels.Accounts
@model GlMainAccountsVM
@{
    ViewBag.Title = ERP.ResourcePack.Accounts.GlMainAccounts.Title;
    string formTrigger = ViewBag.trigger;
}
<div class="card">
    <div class="body">
        @using (Ajax.BeginForm(nameof(ERP.Web.UI.Controllers.Accounts.GlMainAccountsController.PostGlMainAccounts), "GlMainAccounts",
            new AjaxOptions { HttpMethod = "POST", OnBegin = "OnBegin", OnSuccess = "OnSuccess", OnComplete = "OnComplete", OnFailure = "OnFailure" }, new { @id = "mainForm" }))
        {
            @Html.HiddenFor(z => z.Id)
            @Html.HiddenFor(z => z.codeComUtilityIds)
            @Html.HiddenFor(z => z.codeComUtilityTexts)
            <div class="row clearfix">
                <div class="col-sm-6">
                    <div class="form-group form-float">
                        <div class="form-line">
                            @Html.TextBoxFor(z => z.ReferenceCode, new { @class = "form-control", @disabled = "disabled" })
                            @Html.LabelFor(z => z.ReferenceCode, new { @class = "form-label", @style = "pointer-events: none;" })
                        </div>
                    </div>
                </div>
                <div class="col-sm-6">
                    <div class="form-group form-float">
                        <div class="form-line">
                            @Html.TextBoxFor(z => z.Description, new { @class = "form-control", @disabled = "disabled" })
                            @Html.LabelFor(z => z.Description, new { @class = "form-label", @style = "pointer-events: none;" })
                        </div>
                    </div>
                </div>
            </div>
            <div class="row clearfix">
                @Html.Action(nameof(ERP.Web.UI.Controllers.Accounts.GlAccDetailsController.DrawGlAccController), "GlAccDetails",
                    new { glAccHeadersVMs = ViewData["ListGlAccHeadersVM"] == null ? new List<GlAccHeadersVM>() : ViewData["ListGlAccHeadersVM"] as List<GlAccHeadersVM> })
            </div>
            <div class="row clearfix">
                <div class="col-md-12">
                    @if (formTrigger == ERP.Front.Helpers.Enums.Common.FormTriggers.Update.ToString())
                    {
                        <p>
                            @if (Model.IsActive)
                            {
                                <i class="fas fa-check text-success fa-2x"></i>
                            }
                            else
                            {
                                <i class="fas fa-times text-danger fa-2x"></i>
                            }
                            <span>@Html.LabelFor(z => z.IsActive)</span>
                        </p>
                    }
                </div>
            </div>
        }

        <div class="row clearfix">
            <div class="form-group text-center form-float">
                <button type="submit" id="btnSubmition" class="btn btn-info btn-lg m-l-15 waves-effect">@(Model == null ? ERP.ResourcePack.Common.Settings.BtnSave : ERP.ResourcePack.Common.Settings.BtnUpdate)</button>
                <div id="submitLoader" style="display:none">
                    <div class="lds-roller"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div>
                </div>
            </div>
        </div>

    </div>
</div>

<script src="~/Scripts/jquery.validate.min.js"></script>
<script src="~/Scripts/jquery.validate.unobtrusive.min.js"></script>
@Html.Partial("~/ViewsScripts/GlAccDetails/GlAccDetailsScripts.cshtml", ViewData["repeatTrigger"] = "")
@Html.Partial("~/ViewsScripts/GlAccDetails/GlAccDetailsScriptManager.cshtml")

<script>
    $('#btnSubmition').on('click', function () {

        const resultCodeComUtility = GetCodeComUtilites(__arrGlSelect2, 'AccId');

        if (resultCodeComUtility === null) {
            toastr.warning('@ERP.ResourcePack.Accounts.GlJeHeaders.FormDetailNotValid');
            return;
        }

        $('#mainForm #@nameof(Model.codeComUtilityIds)').val(resultCodeComUtility.idsStr);
        $('#mainForm #@nameof(Model.codeComUtilityTexts)').val(resultCodeComUtility.textsStr);

        $('#mainForm').submit();
    });
</script>

@if (Model != null && !string.IsNullOrEmpty(Model.codeComUtilityIds) && !string.IsNullOrEmpty(Model.codeComUtilityTexts))
{
    <script>
        BindCodeComUtilitesDropDowns(__arrGlSelect2,'AccId','@Model.codeComUtilityIds','@Model.codeComUtilityTexts');
    </script>
}